# Spring 입문 - 스프링 DB 접근기술

> 인프런의 "스프링 입문 - 코드로 배우는 스프링 부트, 웹 MVC, DB 접근 기술" 강의를 듣고 정리한 내용입니다.

## 목차
- [H2 데이터베이스 설치](#H2-데이터베이스-설치)
- [순수 Jdbc](#순수-Jdbc)
- [스프링 통합 테스트](#스프링-통합-테스트)
- [스프링 JdbcTemplate](#스프링-JdbcTemplate)
- [JPA](#JPA)
- [스프링 데이터 JPA](#스프링-데이터-JPA)

</br>

---

## H2 데이터베이스 설치

### 설치 및 실행

먼저 [https://www.h2database.com/html/download-archive.html](https://www.h2database.com/html/download-archive.html)에서 1.4.200 버전을 설치해준다.

그 후, terminal에서 h2/bin/h2.sh 파일을 명령어 `chmod 755 h2.sh`을 통해 권한 변경을 하고 명령어 `./h2.sh`를 이용해 실행시킨다.

실행시키게 되면 아래 창이 뜬다.
<p align=center>
<img width="711" alt="스크린샷 2024-01-05 14 22 10" src="https://github.com/hamsangjin/TIL/assets/103736614/736d6dba-b7ac-4d22-b219-b7d835870eac">
</p>

- `JDBC URL` : 파일의 경로

</br>

먼저 아무것도 건드리지 않고 연결을 한다.
<p align=center>
<img width="898" alt="스크린샷 2024-01-05 14 28 17" src="https://github.com/hamsangjin/TIL/assets/103736614/810a2b90-b474-4cbb-8960-d2baf5555e4f">
</p>

위 창이 뜨면 잘 연결된 것이고, 가장 왼쪽 위 버튼을 통해 연결 전 창을 다시 띄운 후, 
</br>
지금처럼 `JDBC URL`을 파일로 설정하게 되면 오류가 날 수 있으므로, `jdbc:h2:tcp://localhost/~/test`로 경로를 변경해 파일에 직접 접근하는 것이 아니라 소켓을 통해 접근할 수 있게 변경해준다.
</br>
그 후 로컬에 test.mv.db가 생성하는지 삭제 후 확인해보고 생성된다면 정상 작동되는 것이다.

### 테이블 생성
기존에 진행했었던 `member` 테이블을 생성해보자.
<p align=center>
<img width="462" alt="스크린샷 2024-01-05 14 45 09" src="https://github.com/hamsangjin/TIL/assets/103736614/d6bc6120-3aaf-4311-b66f-04aa94231808">
</p>

왼쪽을 보면 쿼리문에 따라 `member`라는 테이블이 생성된 것을 볼 수 있다.

- `bigint` : java의 long과 동일
- `generated by default as identity` : 먼저 값을 세팅하지 않고, 데이터가 삽입됐을 때 자동으로 값을 채워줌
- `varchar` : 가변길이 문자열을 의미

</br>


이제 `member` 테이블에 값을 삽입해보고 조회해 확인해보자.
<p align=center>
<img width="273" height="300" alt="스크린샷 2024-01-05 14 53 46" src="https://github.com/hamsangjin/TIL/assets/103736614/c2148147-fe54-4a06-9c98-a03da4205e3e">
<img width="273" height="300" alt="스크린샷 2024-01-05 14 55 53" src="https://github.com/hamsangjin/TIL/assets/103736614/562adcb0-6523-4ecc-81fe-090d1290da2b">
</p>

정상적으로 삽입되며, id값이 자동으로 추가된 걸 확인할 수 있다.

</br>


이제 이러한 sql문도 같이 관리하기 위해 `hello-spring/sql` 폴더에 `ddl.sql`이라는 파일을 생성해 아까 작성한 쿼리문을 저장해 관리한다.
<p align=center>
<img width="786" alt="스크린샷 2024-01-05 15 04 53" src="https://github.com/hamsangjin/TIL/assets/103736614/68d948b2-ca8d-4077-b588-af6d02b93284">
</p>

--- 

## 순수 Jdbc


### Jdbc 환경설정
> 지금 진행하는 것은 오래된 방법이라, 이런 식으로 사용했었구나 ~ 라는 식으로 가볍게 듣는 것이 좋다.


먼저 `build.gradle` 파일에 `jdbc`, `h2 데이터베이스` 관련 라이브러리를 추가해주자
<p align=center>
<img width="964" alt="스크린샷 2024-01-05 15 13 59" src="https://github.com/hamsangjin/TIL/assets/103736614/2243c850-6222-4533-9d00-586e8479185a">
</p>

* java는 DB랑 연결하려면 JDBC 드라이버가 꼭 있어야 한다.

</br>

이제 DB와 연결하기 위해서는 접속 정보가 필요한데, 스프링 부트에서는 `application.properties`에 경로만 넣으면 드라이버 설치 세팅이 끝난다.
<img width="767" alt="스크린샷 2024-01-05 15 37 13" src="https://github.com/hamsangjin/TIL/assets/103736614/db4541e9-edde-45e6-aae8-c12d5259bffe">
* 스프링부트 2.4부터 `spring.datasource.username=sa`을 추가해야 오류가 발생 안 한다.

### Jdbc 리포지토리 구현

먼저 구현 클래스를 만들어 `MemberRepository`의 메소드들을 불러와준다.
<img width="926" alt="스크린샷 2024-01-05 15 44 36" src="https://github.com/hamsangjin/TIL/assets/103736614/3f16f61f-ae0b-4bba-aebd-6d72bedb52ca">

